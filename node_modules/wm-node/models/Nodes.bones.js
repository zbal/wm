model = Backbone.Collection.extend({
    model: models['Node'],
    url: '/api/Node',
    // Filter nodes by continent_code and country_code
    filterByLocation: function(location, options) {
        options || (options = {});
        var error = options.error || function() {};
        var success = options.success || function() {};

        // return the entire collection of nodes if no location provided
        if (!location) return success(this);

        // return the filtered collection matching both continent and country
        if (location.continent_code && location.country_code) {
            var collection = this.filter(function(node) {
                if (node.get('continent_code') === location.continent_code 
                    && node.get('country_code') === location.country_code) {
                    return true;
                }
            });
            return success(collection);
        }
        
        // return the filtered collection matching only the continent
        if (location.continent_code) {
            var collection = this.filter(function(node) {
                if (node.get('continent_code') === location.continent_code) {
                    return true;
                }
            });
            return success(collection);
        }
        
        // bad location object
        return error(new Error('Invalid location parameter'));
    },
    filterByStatus: function(status, options) {
        options || (options = {});
        var error = options.error || function() {};
        var success = options.success || function() {};
        
        if (!status) return error(new Error('Status required'));

        var collection = this.filter(function(node) {
            return node.get('status') === status;
        });
        return success(collection);
    }
});