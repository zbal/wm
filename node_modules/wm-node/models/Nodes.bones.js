model = Backbone.Collection.extend({
    model: models['Node'],
    url: '/api/Node',
    // Filter nodes by continent_code and country_code
    filterByLocations: function(locations) {
        // return the entire collection of nodes if no locations provided
        if (!locations) return this;
        if (_.isEmpty(locations)) return this;
        
        // Array-ize locations if not yet
        if (!_.isArray(locations)) {
            var array = [];
            array.push(locations);
            locations = array;
        }

        var list = this.filter(function(node) {
            var result = false;
            _.each(locations, function(location) {
                if (location.continent_code && node.get('continent_code') === location.continent_code) {
                    if (!location.country_code) {
                        return result = true;
                    } else if (node.get('country_code') === location.country_code) {
                        return result = true;
                    }
                }
            });
            return result;
        });

        // Need to return a valid collection
        var collection = new Bones.plugin.models.Nodes();
        collection.add(list, {silent: true});
        return collection;
    },
    filterByStatus: function(status) {
        var list = this.filter(function(node) {
            return node.get('status') === status;
        });

        // Need to return a valid collection
        var collection = new Bones.plugin.models.Nodes();
        collection.add(list, {silent: true});
        return collection;
    }
});